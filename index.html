<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STARBIZBOOSTER</title>
    <style>
        /* Styles généraux */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to right, #f3f4f7, #e6ebf0);
            color: #333;
        }

        header {
            background: linear-gradient(135deg, #4c6793, #283e6d);
            color: white;
            text-align: center;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            margin: 0;
            font-size: 1.8rem;
        }

        main {
            padding: 20px;
            max-width: 900px;
            margin: auto;
        }

        section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        section::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 80%);
            transform: rotate(45deg);
            animation: shimmer 6s infinite linear;
            z-index: 0;
        }

        @keyframes shimmer {
            0% { transform: rotate(45deg) translateX(-200%); }
            100% { transform: rotate(45deg) translateX(200%); }
        }

        h2 {
            color: #4c6793;
            position: relative;
            z-index: 1;
        }

        form label, form input {
            display: block;
            margin-bottom: 10px;
            font-size: 1rem;
            position: relative;
            z-index: 1;
        }

        form input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            background: #f3f3f3;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background 0.3s, box-shadow 0.3s;
        }

        form input:focus {
            background: #ffffff;
            box-shadow: 0 0 5px rgba(76, 103, 147, 0.8);
            outline: none;
        }

        .btn {
            display: inline-block;
            padding: 12px 20px;
            background: #4c6793;
            color: white;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s;
            font-size: 1rem;
            position: relative;
            z-index: 1;
        }
        .btn:hover {
            background: #283e6d;
            transform: translateY(-2px);
        }

        #totals {
            background: #eef1f6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        #totals p {
            margin: 10px 0;
            font-weight: bold;
            font-size: 1.1rem;
            color: #4c6793;
        }

        #solde {
            font-size: 1.4rem;
            color: #283e6d;
            font-weight: bold;
        }

        #search-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        #search-container select {
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: #f3f3f3;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 150px;
        }

        #search-container input {
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: #f3f3f3;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 250px;
            transition: background 0.3s, box-shadow 0.3s;
        }

        #search-container input:focus {
            background: #ffffff;
            box-shadow: 0 0 5px rgba(76, 103, 147, 0.8);
            outline: none;
        }

        #history-section {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        #history div {
            margin-bottom: 10px;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            main {
                padding: 10px;
            }

            .btn {
                width: 100%;
            }

            #search-container input {
                width: 100%;
            }

            #search-container select {
                width: 100%;
            }
        }
        

main {
    flex: 1; /* Permet au contenu principal de prendre tout l'espace disponible */
}

footer {
    text-align: center;
    padding: 1px;
    background-color: #4c6793; /* Couleur de fond */
    color: white; /* Couleur du texte */
    font-size: 0.9rem; /* Taille de la police */
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
}


.hidden {
    display: none;
}

/* Styles de base pour le corps de la page */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
    color: #333;
}

/* Style du header */
header {
    background-color: #2c3e50;
    color: #fff;
    padding: 20px;
    text-align: center;
}

/* Conteneur du logo et du nom de l'application */
.logo-container {
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Style du logo */
.logo {
    width: 40px; /* Logo plus petit */
    height: auto;
    margin-right: 10px; /* Espace entre le logo et le texte */
}

/* Style du nom de l'application */
.app-name {
    font-size: 32px;
    font-weight: bold;
    margin: 0;
    
}

/* Style du texte en dessous */
.footer-text {
    font-size: 12px;
    margin-top: 10px;
    font-style: italic;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

        body {
    overflow-x: hidden;
        }

        body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

header {
    flex-shrink: 0;  /* Empêche l'entête de se réduire */
}

main {
    flex-grow: 1;    /* Fait que le contenu principal occupe l'espace restant */
}

        #myChart {
    width: 100%;
    height: 400px; /* ou la taille que vous préférez */
        }

        

    </style>
    <!-- Inclure Chart.js via CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    
</head>
<body>
<header>
<div class="logo-container">
            <img src="logo.png" alt="Logo de STARBIZBOOSTER" class="logo">
            <h1 class="app-name">STARBIZBOOSTER</h1>
        </div>
        <p class="footer-text">Programme de suivi financier créé par Josias AKODJENOU</p>
    
   
</header>
<main>
    <!-- Conteneur pour le graphique -->
    <canvas id="myChart" width="400" height="200"></canvas>

    <section>
        <h2>Ajouter des Revenus</h2>
        <form id="income-form">
            <label for="income-amount">Montant:</label>
            <input type="number" id="income-amount" placeholder="Montant en FCFA">
            <label for="income-description">Motif:</label>
            <input type="text" id="income-description" placeholder="Ex: salaire, vente...">
            <button type="button" class="btn" id="add-income">Ajouter Revenus</button>
        </form>
    </section>

    <section>
        <h2>Ajouter des Dépenses</h2>
        <form id="expense-form">
            <label for="expense-amount">Montant:</label>
            <input type="number" id="expense-amount" placeholder="Montant en FCFA">
            <label for="expense-description">Motif:</label>
            <input type="text" id="expense-description" placeholder="Ex: alimentation, loyer...">
            <button type="button" class="btn" id="add-expense">Ajouter Dépense</button>
        </form>
    </section>

    <section id="totals">
        <!-- Ajout des IDs cliquables -->
        <p><strong>Total des Revenus journalier:</strong> 
            <span id="total-income" class="clickable">0 FCFA</span>
        </p>
        <p><strong>Total des Dépenses journalier:</strong> 
            <span id="total-expense" class="clickable">0 FCFA</span>
        </p>
        <p><strong>Solde Actuel:</strong> 
            <span id="solde" class="clickable">0 FCFA</span>
        </p>
    </section>

    <section>
        <h2>Historique</h2>
        <div id="search-container">
            <select id="search-filter">
                <option value="date">Date</option>
                <option value="amount">Montant</option>
                <option value="description">Motif</option>
            </select>
            <input type="text" id="search-input" placeholder="Rechercher...">
        </div>

        <div id="history-section">
            <div id="history">
                <!-- Historique affiché ici -->
            </div>
        </div>
    </section>

    <section>
        <button class="btn" id="download-pdf">Télécharger l'historique en PDF</button>
    </section>

<!-- <section>
    <h2>Options</h2>
    <button class="btn" id="reset-history">Réinitialiser l'historique</button>
</section> -->


</main>


    <script>
    
    // Télécharger l'historique en PDF
document.getElementById('download-pdf').addEventListener('click', () => {
    const { jsPDF } = window.jspdf; // Récupérer la classe jsPDF
    const doc = new jsPDF();

    // Titre du PDF
    doc.setFontSize(16);
    doc.text("Historique des Finances - FCFA", 10, 10);

    // Variables pour le contenu
    let y = 20; // Position verticale de départ

    history.forEach((item, index) => {
        const content = `${index + 1}. [${item.date}] ${item.type}: ${item.amount} FCFA - ${item.description}`;
        doc.setFontSize(12);
        doc.text(content, 10, y);
        y += 10; // Espacement entre chaque ligne

        // Gérer les débordements de page
        if (y > 280) {
            doc.addPage();
            y = 10; // Réinitialiser la position verticale
        }
    });

    // Sauvegarder le fichier
    doc.save("Historique_Financier.pdf");
});


// Variables globales
let totalIncome = 0;
let totalExpense = 0;
let balance = 0;
let history = [];

// Charger les données depuis le localStorage au démarrage
window.addEventListener('load', () => {
    const savedIncome = localStorage.getItem('totalIncome');
    const savedExpense = localStorage.getItem('totalExpense');
    const savedBalance = localStorage.getItem('balance');
    const savedHistory = localStorage.getItem('history');

    totalIncome = savedIncome ? parseFloat(savedIncome) : 0;
    totalExpense = savedExpense ? parseFloat(savedExpense) : 0;
    balance = savedBalance ? parseFloat(savedBalance) : 0;
    history = savedHistory ? JSON.parse(savedHistory) : [];

    updateUI();
    scheduleDailyReset(); // Démarrer la réinitialisation automatique
});

// Sauvegarder les données dans le localStorage
function saveToLocalStorage() {
    localStorage.setItem('totalIncome', totalIncome);
    localStorage.setItem('totalExpense', totalExpense);
    localStorage.setItem('balance', balance);
    localStorage.setItem('history', JSON.stringify(history));
}

// Ajouter un revenu
document.getElementById('add-income').addEventListener('click', () => {
    let amount = parseFloat(document.getElementById('income-amount').value);
    let description = document.getElementById('income-description').value;
    if (amount > 0 && description) {
        totalIncome += amount;
        balance = totalIncome - totalExpense;
        let date = new Date().toLocaleDateString();
        let time = new Date().toLocaleTimeString();
        history.unshift({ type: 'Revenu', amount, description, date, time });
        updateUI();
        clearForm('income');
    }
});

// Ajouter une dépense
document.getElementById('add-expense').addEventListener('click', () => {
    let amount = parseFloat(document.getElementById('expense-amount').value);
    let description = document.getElementById('expense-description').value;
    if (amount > 0 && description) {
        totalExpense += amount;
        balance = totalIncome - totalExpense;
        let date = new Date().toLocaleDateString();
        let time = new Date().toLocaleTimeString();
        history.unshift({ type: 'Dépense', amount, description, date, time });
        updateUI();
        clearForm('expense');
    }
});

// Mettre à jour l'interface utilisateur
function updateUI() {
    document.getElementById('total-income').innerText = `${totalIncome} FCFA`;
    document.getElementById('total-expense').innerText = `${totalExpense} FCFA`;
    document.getElementById('solde').innerText = `${balance} FCFA`;

    let historyHTML = '';
    history.forEach(item => {
        historyHTML += `
            <div>
                <strong>${item.type}</strong> - ${item.amount} FCFA<br>
                Motif: ${item.description} <br>
                Date: ${item.date} à ${item.time}
            </div>
            <hr>
        `;
    });
    document.getElementById('history').innerHTML = historyHTML;

    // Sauvegarder les données à chaque mise à jour
    saveToLocalStorage();
}

// Réinitialiser les champs de saisie
function clearForm(type) {
    if (type === 'income') {
        document.getElementById('income-amount').value = '';
        document.getElementById('income-description').value = '';
    } else {
        document.getElementById('expense-amount').value = '';
        document.getElementById('expense-description').value = '';
    }
}

// Rechercher dans l'historique
document.getElementById('search-input').addEventListener('input', () => {
    let filter = document.getElementById('search-filter').value;
    let query = document.getElementById('search-input').value.toLowerCase();

    let filteredHistory = history.filter(item => {
        if (filter === 'date') {
            return item.date.includes(query);
        } else if (filter === 'amount') {
            return item.amount.toString().includes(query);
        } else {
            return item.description.toLowerCase().includes(query);
        }
    });

    let historyHTML = '';
    filteredHistory.forEach(item => {
        historyHTML += `
            <div>
                <strong>${item.type}</strong> - ${item.amount} FCFA<br>
                Motif: ${item.description} <br>
                Date: ${item.date} à ${item.time}
            </div>
            <hr>
        `;
    });
    document.getElementById('history').innerHTML = historyHTML;
});

// Réinitialiser l'historique et les données
document.getElementById('reset-history').addEventListener('click', () => {
    if (confirm("Êtes-vous sûr de vouloir réinitialiser toutes les données ?")) {
        totalIncome = 0;
        totalExpense = 0;
        balance = 0;
        history = [];
        saveToLocalStorage();
        updateUI();
        alert("Historique réinitialisé avec succès !");
    }
});

// Télécharger l'historique en PDF
document.getElementById('download-pdf').addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Titre du PDF
    doc.setFontSize(16);
    doc.text("Historique des Finances - FCFA", 10, 10);

    // Variables pour le contenu
    let y = 20; // Position verticale de départ

    history.forEach((item, index) => {
        const content = `${index + 1}. [${item.date} à ${item.time}] ${item.type}: ${item.amount} FCFA - ${item.description}`;
        doc.setFontSize(12);
        doc.text(content, 10, y);
        y += 10; // Espacement entre chaque ligne

        // Gérer les débordements de page
        if (y > 280) {
            doc.addPage();
            y = 10; // Réinitialiser la position verticale
        }
    });

    // Sauvegarder le fichier
    doc.save("Historique_Financier.pdf");
});

// Planifier la réinitialisation automatique à 23H59
function scheduleDailyReset() {
    const now = new Date();
    const millisTillMidnight = new Date(
        now.getFullYear(),
        now.getMonth(),
        now.getDate(),
        23, 59, 59, 999
    ) - now;

    setTimeout(() => {
        const today = new Date().toLocaleDateString();
        const time = "23:59:59";

        // Ajouter les totaux de la journée dans l'historique
        history.unshift({ type: 'Résumé', amount: totalIncome, description: 'Total des entrées', date: today, time });
        history.unshift({ type: 'Résumé', amount: totalExpense, description: 'Total des sorties', date: today, time });
        history.unshift({ type: 'Résumé', amount: balance, description: 'Solde final', date: today, time });

        // Réinitialiser les totaux sans toucher au solde
        totalIncome = 0;
        totalExpense = 0;

        updateUI();
        scheduleDailyReset(); // Planifier la prochaine réinitialisation
    }, millisTillMidnight);
}

    </script>
    
    <script>
        let myChart = null;  // Déclaration de la variable pour le graphique

function generateChart() {
    const ctx = document.getElementById('myChart').getContext('2d');  // Récupérer l'élément canvas

    // Organiser les données pour le graphique
    const labels = [];  // Contient les dates pour l'axe des X
    const incomeData = [];  // Contient les revenus
    const expenseData = [];  // Contient les dépenses

    // Parcourir l'historique pour récupérer les données
    history.forEach(item => {
        if (!labels.includes(item.date)) {
            labels.push(item.date);  // Ajouter la date unique à l'axe des X
            incomeData.push(0);  // Initialiser les valeurs
            expenseData.push(0);  // Initialiser les valeurs
        }
        const index = labels.indexOf(item.date);
        if (item.type === 'Revenu') {
            incomeData[index] += item.amount;  // Ajouter le revenu à la date correspondante
        } else if (item.type === 'Dépense') {
            expenseData[index] += item.amount;  // Ajouter la dépense à la date correspondante
        }
    });

    // Si le graphique existe déjà, le détruire avant de le redessiner
    if (myChart) {
        myChart.destroy();
    }

    // Créer le graphique avec les nouvelles données
    const data = {
        labels: labels,  // Utiliser les dates comme étiquettes
        datasets: [
            {
                label: 'Revenus',
                data: incomeData,  // Données pour les revenus
                backgroundColor: 'green',
                borderColor: 'green',
                borderWidth: 1,
                fill: false
            },
            {
                label: 'Dépenses',
                data: expenseData,  // Données pour les dépenses
                backgroundColor: 'red',
                borderColor: 'red',
                borderWidth: 1,
                fill: false
            }
        ]
    };

    // Créer un nouveau graphique ou mettre à jour l'existant
    myChart = new Chart(ctx, {
        type: 'bar',  // Type de graphique (ici un graphique en ligne)
        data: data,  // Passer les données organisées
        options: {
            responsive: true,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Date'  // Légende de l'axe X
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Montant (FCFA)'  // Légende de l'axe Y
                    },
                    beginAtZero: true  // Commencer l'axe Y à 0
                }
            },
            plugins: {
                title: {
                    display: true,
                    text: 'Graphique des Finances'  // Titre du graphique
                },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return `${tooltipItem.dataset.label}: ${tooltipItem.raw} FCFA`;  // Format des tooltips
                        }
                    }
                }
     
